{#
  FormField Component
  Purpose: Standardized form inputs with consistent styling and validation
  
  Props:
  - type: 'text' | 'textarea' | 'select' | 'checkbox' | 'radio' | 'file' | 'email' | 'password' | 'number' | 'search'
  - name: string (required)
  - label: string
  - placeholder: string
  - value: string
  - required: boolean
  - disabled: boolean
  - readonly: boolean
  - rows: number (for textarea)
  - options: array (for select/radio)
  - helpText: string
  - errorText: string
  - size: 'sm' | 'md' | 'lg'
  - variant: 'default' | 'modern'
  - id: string (auto-generated if not provided)
  - multiple: boolean (for select/file)
  - accept: string (for file inputs)
  - maxSize: string (for file inputs)
  - htmxAttributes: object (for HTMX integration)
  - class: string (additional classes)
#}

{# Main FormField macro #}
{% macro FormField(type='text', name='', label='', placeholder='', value='', required=false, disabled=false, readonly=false, rows=4, options=[], helpText='', errorText='', size='md', variant='default', id='', multiple=false, accept='', maxSize='', htmxAttributes={}, class='') %}
  {% set fieldId = id or (name + '_' + type) %}
  {% set hasError = errorText %}
  {% set isCheckboxOrRadio = type in ['checkbox', 'radio'] %}
  
  <div class="form-field-container {{ 'form-field-error' if hasError }} {{ class }}" 
       data-field-type="{{ type }}" data-field-size="{{ size }}">
    
    {# Label (positioned based on field type) #}
    {% if label and not isCheckboxOrRadio %}
      <label for="{{ fieldId }}" class="form-label {{ 'form-label-' + size }} {{ 'form-label-required' if required }}">
        {{ label }}
        {% if required %}<span class="form-required-indicator">*</span>{% endif %}
      </label>
    {% endif %}
    
    {# Field wrapper for styling consistency #}
    <div class="form-input-wrapper {{ 'form-input-wrapper-' + variant }} {{ 'form-input-wrapper-' + size }}">
      
      {# Text Input #}
      {% if type in ['text', 'email', 'password', 'number', 'search', 'url', 'tel'] %}
        <input 
          type="{{ type }}"
          id="{{ fieldId }}"
          name="{{ name }}"
          class="form-input form-input-{{ size }} {{ 'form-input-error' if hasError }}"
          {% if placeholder %}placeholder="{{ placeholder }}"{% endif %}
          {% if value %}value="{{ value }}"{% endif %}
          {% if required %}required{% endif %}
          {% if disabled %}disabled{% endif %}
          {% if readonly %}readonly{% endif %}
          {% for attr, val in htmxAttributes %}{{ attr }}="{{ val }}"{% endfor %}
        />
        
        {# Search icon for search inputs #}
        {% if type == 'search' %}
          <i class="form-input-icon fas fa-search"></i>
        {% endif %}
      
      {# Textarea #}
      {% elif type == 'textarea' %}
        <textarea 
          id="{{ fieldId }}"
          name="{{ name }}"
          rows="{{ rows }}"
          class="form-textarea form-textarea-{{ size }} {{ 'form-textarea-error' if hasError }}"
          {% if placeholder %}placeholder="{{ placeholder }}"{% endif %}
          {% if required %}required{% endif %}
          {% if disabled %}disabled{% endif %}
          {% if readonly %}readonly{% endif %}
          {% for attr, val in htmxAttributes %}{{ attr }}="{{ val }}"{% endfor %}
        >{{ value }}</textarea>
      
      {# Select Dropdown #}
      {% elif type == 'select' %}
        <select 
          id="{{ fieldId }}"
          name="{{ name }}"
          class="form-select form-select-{{ size }} {{ 'form-select-error' if hasError }}"
          {% if required %}required{% endif %}
          {% if disabled %}disabled{% endif %}
          {% if multiple %}multiple{% endif %}
          {% for attr, val in htmxAttributes %}{{ attr }}="{{ val }}"{% endfor %}
        >
          {% if placeholder and not multiple %}
            <option value="" disabled {% if not value %}selected{% endif %}>{{ placeholder }}</option>
          {% endif %}
          {% for option in options %}
            {% if option.value is defined %}
              <option value="{{ option.value }}" 
                      {% if option.value == value or (multiple and value and option.value in value) %}selected{% endif %}
                      {% if option.disabled %}disabled{% endif %}>
                {{ option.label or option.value }}
              </option>
            {% else %}
              <option value="{{ option }}" {% if option == value %}selected{% endif %}>{{ option }}</option>
            {% endif %}
          {% endfor %}
        </select>
        <i class="form-select-icon fas fa-chevron-down"></i>
      
      {# File Input #}
      {% elif type == 'file' %}
        <div class="form-file-input-wrapper">
          <input 
            type="file"
            id="{{ fieldId }}"
            name="{{ name }}"
            class="form-file-input"
            {% if required %}required{% endif %}
            {% if disabled %}disabled{% endif %}
            {% if multiple %}multiple{% endif %}
            {% if accept %}accept="{{ accept }}"{% endif %}
            {% for attr, val in htmxAttributes %}{{ attr }}="{{ val }}"{% endfor %}
          />
          <label for="{{ fieldId }}" class="form-file-label form-file-label-{{ size }}">
            <i class="fas fa-cloud-upload-alt form-file-icon"></i>
            <span class="form-file-text">
              {% if placeholder %}{{ placeholder }}{% else %}Choose file{% if multiple %}s{% endif %}{% endif %}
            </span>
            {% if maxSize %}
              <span class="form-file-hint">Max size: {{ maxSize }}</span>
            {% endif %}
          </label>
        </div>
      
      {# Checkbox #}
      {% elif type == 'checkbox' %}
        <div class="form-checkbox-wrapper">
          <input 
            type="checkbox"
            id="{{ fieldId }}"
            name="{{ name }}"
            value="{{ value or 'true' }}"
            class="form-checkbox form-checkbox-{{ size }}"
            {% if disabled %}disabled{% endif %}
            {% for attr, val in htmxAttributes %}{{ attr }}="{{ val }}"{% endfor %}
          />
          {% if label %}
            <label for="{{ fieldId }}" class="form-checkbox-label {{ 'form-checkbox-label-required' if required }}">
              {{ label }}
              {% if required %}<span class="form-required-indicator">*</span>{% endif %}
            </label>
          {% endif %}
        </div>
      
      {# Radio Buttons #}
      {% elif type == 'radio' %}
        <div class="form-radio-group form-radio-group-{{ size }}">
          {% for option in options %}
            {% set radioId = fieldId + '_' + loop.index %}
            <div class="form-radio-wrapper">
              <input 
                type="radio"
                id="{{ radioId }}"
                name="{{ name }}"
                value="{{ option.value or option }}"
                class="form-radio form-radio-{{ size }}"
                {% if (option.value or option) == value %}checked{% endif %}
                {% if disabled or option.disabled %}disabled{% endif %}
                {% for attr, val in htmxAttributes %}{{ attr }}="{{ val }}"{% endfor %}
              />
              <label for="{{ radioId }}" class="form-radio-label">
                {{ option.label or option }}
              </label>
            </div>
          {% endfor %}
        </div>
      {% endif %}
      
      {# Loading indicator for HTMX requests #}
      {% if htmxAttributes %}
        <div class="form-loading-indicator htmx-indicator">
          <i class="fas fa-spinner fa-spin"></i>
        </div>
      {% endif %}
    </div>
    
    {# Help text #}
    {% if helpText %}
      <p class="form-help-text">{{ helpText }}</p>
    {% endif %}
    
    {# Error message #}
    {% if errorText %}
      <p class="form-error-text" role="alert">
        <i class="fas fa-exclamation-circle"></i>
        {{ errorText }}
      </p>
    {% endif %}
  </div>
{% endmacro %}

{# Specialized form field macros for common patterns #}

{# Text Input with validation #}
{% macro TextInput(name, label='', placeholder='', value='', required=false, helpText='', errorText='', size='md') %}
  {{ FormField(type='text', name=name, label=label, placeholder=placeholder, value=value, required=required, helpText=helpText, errorText=errorText, size=size) }}
{% endmacro %}

{# Search Input with HTMX #}
{% macro SearchInput(name='search', placeholder='Search...', target='', trigger='keyup changed delay:300ms', size='md', expandOnFocus=true) %}
  {% set htmxAttrs = {} %}
  {% if target %}
    {% set htmxAttrs = htmxAttrs | merge({'hx-get': '/' + name, 'hx-target': target, 'hx-trigger': trigger}) %}
  {% endif %}
  
  <div class="form-search-wrapper {{ 'form-search-expandable' if expandOnFocus }}">
    {{ FormField(
      type='search', 
      name=name, 
      placeholder=placeholder, 
      size=size,
      htmxAttributes=htmxAttrs,
      class='form-search-input'
    ) }}
  </div>
{% endmacro %}

{# Email Input with validation #}
{% macro EmailInput(name='email', label='Email Address', placeholder='Enter your email', value='', required=true, helpText='', errorText='', size='md') %}
  {{ FormField(type='email', name=name, label=label, placeholder=placeholder, value=value, required=required, helpText=helpText, errorText=errorText, size=size) }}
{% endmacro %}

{# Password Input with show/hide toggle #}
{% macro PasswordInput(name='password', label='Password', placeholder='Enter your password', required=true, showToggle=true, helpText='', errorText='', size='md') %}
  <div class="form-password-wrapper" data-show-toggle="{{ showToggle }}">
    {{ FormField(type='password', name=name, label=label, placeholder=placeholder, required=required, helpText=helpText, errorText=errorText, size=size, class='form-password-field') }}
    {% if showToggle %}
      <button type="button" class="form-password-toggle" onclick="togglePasswordVisibility('{{ name }}')">
        <i class="fas fa-eye" data-show-icon></i>
        <i class="fas fa-eye-slash" data-hide-icon style="display: none;"></i>
      </button>
    {% endif %}
  </div>
{% endmacro %}

{# Select Dropdown with enhanced styling #}
{% macro SelectField(name, options, label='', placeholder='Select an option', value='', required=false, multiple=false, helpText='', errorText='', size='md') %}
  {{ FormField(type='select', name=name, options=options, label=label, placeholder=placeholder, value=value, required=required, multiple=multiple, helpText=helpText, errorText=errorText, size=size) }}
{% endmacro %}

{# Textarea with auto-resize #}
{% macro TextareaField(name, label='', placeholder='', value='', rows=4, required=false, autoResize=true, helpText='', errorText='', size='md') %}
  {{ FormField(type='textarea', name=name, label=label, placeholder=placeholder, value=value, rows=rows, required=required, helpText=helpText, errorText=errorText, size=size, class='form-textarea-auto-resize' if autoResize) }}
{% endmacro %}

{# Checkbox with enhanced styling #}
{% macro CheckboxField(name, label, value='true', checked=false, required=false, helpText='', errorText='', size='md') %}
  <div class="form-field-container">
    <div class="form-checkbox-wrapper">
      <input 
        type="checkbox"
        id="{{ name }}"
        name="{{ name }}"
        value="{{ value }}"
        class="form-checkbox form-checkbox-{{ size }}"
        {% if checked %}checked{% endif %}
        {% if required %}required{% endif %}
      />
      <label for="{{ name }}" class="form-checkbox-label {{ 'form-checkbox-label-required' if required }}">
        {{ label }}
        {% if required %}<span class="form-required-indicator">*</span>{% endif %}
      </label>
    </div>
    {% if helpText %}
      <p class="form-help-text">{{ helpText }}</p>
    {% endif %}
    {% if errorText %}
      <p class="form-error-text" role="alert">
        <i class="fas fa-exclamation-circle"></i>
        {{ errorText }}
      </p>
    {% endif %}
  </div>
{% endmacro %}

{# Radio Button Group #}
{% macro RadioGroup(name, options, label='', value='', required=false, helpText='', errorText='', size='md', layout='vertical') %}
  <div class="form-field-container">
    {% if label %}
      <fieldset class="form-fieldset">
        <legend class="form-legend {{ 'form-legend-required' if required }}">
          {{ label }}
          {% if required %}<span class="form-required-indicator">*</span>{% endif %}
        </legend>
        <div class="form-radio-group form-radio-group-{{ size }} form-radio-group-{{ layout }}">
          {% for option in options %}
            {% set radioId = name + '_' + loop.index %}
            <div class="form-radio-wrapper">
              <input 
                type="radio"
                id="{{ radioId }}"
                name="{{ name }}"
                value="{{ option.value or option }}"
                class="form-radio form-radio-{{ size }}"
                {% if (option.value or option) == value %}checked{% endif %}
                {% if required %}required{% endif %}
              />
              <label for="{{ radioId }}" class="form-radio-label">
                {{ option.label or option }}
              </label>
            </div>
          {% endfor %}
        </div>
      </fieldset>
    {% endif %}
    {% if helpText %}
      <p class="form-help-text">{{ helpText }}</p>
    {% endif %}
    {% if errorText %}
      <p class="form-error-text" role="alert">
        <i class="fas fa-exclamation-circle"></i>
        {{ errorText }}
      </p>
    {% endif %}
  </div>
{% endmacro %} 