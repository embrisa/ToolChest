{#
  DropZone Component
  Purpose: Apple-style file upload with drag and drop functionality
  
  Props:
  - name: string (required for form submission)
  - accept: string (file types, e.g., 'image/*', '.pdf,.doc,.docx')
  - multiple: boolean (allow multiple files)
  - maxSize: string (e.g., '10MB', '5GB')
  - maxFiles: number (max number of files if multiple)
  - disabled: boolean
  - required: boolean
  - size: 'sm' | 'md' | 'lg' | 'xl'
  - variant: 'default' | 'compact' | 'bordered'
  - icon: string (FontAwesome icon class)
  - title: string (main text)
  - subtitle: string (description text)
  - hint: string (additional help text)
  - preview: boolean (show file previews)
  - autoUpload: boolean (auto-upload when files are dropped)
  - htmxAttributes: object (for HTMX integration)
  - onDrop: string (JavaScript function name to call on drop)
  - class: string (additional classes)
  - id: string (unique identifier)
#}

{# Main DropZone macro #}
{% macro DropZone(name='file', accept='', multiple=false, maxSize='10MB', maxFiles=10, disabled=false, required=false, size='md', variant='default', icon='fas fa-cloud-upload-alt', title='', subtitle='', hint='', preview=true, autoUpload=false, htmxAttributes={}, onDrop='', class='', id='') %}
  {% set dropzoneId = id or (name + '_dropzone') %}
  {% set fileInputId = dropzoneId + '_input' %}
  
  {# Default text based on configuration #}
  {% set defaultTitle = title or ('Drop file' + ('s' if multiple else '') + ' here or click to browse') %}
  {% set defaultSubtitle = subtitle or ('Supports ' + (accept or 'all file types')) %}
  {% set defaultHint = hint or ('Max size: ' + maxSize + (', Max files: ' + maxFiles if multiple and maxFiles > 1 else '')) %}

  <div id="{{ dropzoneId }}" 
       class="dropzone dropzone-{{ size }} dropzone-{{ variant }} {{ 'dropzone-disabled' if disabled }} {{ class }}"
       data-dropzone-name="{{ name }}"
       data-dropzone-accept="{{ accept }}"
       data-dropzone-multiple="{{ multiple }}"
       data-dropzone-max-size="{{ maxSize }}"
       data-dropzone-max-files="{{ maxFiles if multiple else 1 }}"
       data-dropzone-preview="{{ preview }}"
       data-dropzone-auto-upload="{{ autoUpload }}"
       data-dropzone-on-drop="{{ onDrop }}"
       {% if disabled %}data-disabled="true"{% endif %}
       {% if required %}data-required="true"{% endif %}>
    
    {# Hidden file input #}
    <input type="file" 
           id="{{ fileInputId }}"
           name="{{ name }}"
           class="dropzone-input"
           {% if accept %}accept="{{ accept }}"{% endif %}
           {% if multiple %}multiple{% endif %}
           {% if required %}required{% endif %}
           {% if disabled %}disabled{% endif %}
           {% for attr, val in htmxAttributes %}{{ attr }}="{{ val }}"{% endfor %}
           style="display: none;" />
    
    {# Dropzone content area #}
    <div class="dropzone-content" onclick="{% if not disabled %}document.getElementById('{{ fileInputId }}').click(){% endif %}">
      
      {# Default state #}
      <div class="dropzone-default-state">
        <div class="dropzone-icon-container dropzone-icon-{{ size }}">
          <i class="{{ icon }} dropzone-icon"></i>
        </div>
        
        <div class="dropzone-text-content">
          <h4 class="dropzone-title">{{ defaultTitle }}</h4>
          {% if defaultSubtitle %}
            <p class="dropzone-subtitle">{{ defaultSubtitle }}</p>
          {% endif %}
          {% if defaultHint %}
            <p class="dropzone-hint">{{ defaultHint }}</p>
          {% endif %}
        </div>
      </div>
      
      {# Drag over state #}
      <div class="dropzone-dragover-state" style="display: none;">
        <div class="dropzone-icon-container dropzone-icon-{{ size }}">
          <i class="fas fa-download dropzone-icon"></i>
        </div>
        <div class="dropzone-text-content">
          <h4 class="dropzone-title">Release to upload</h4>
          {% if multiple %}
            <p class="dropzone-subtitle">Drop your files here</p>
          {% else %}
            <p class="dropzone-subtitle">Drop your file here</p>
          {% endif %}
        </div>
      </div>
      
      {# Processing state #}
      <div class="dropzone-processing-state" style="display: none;">
        <div class="dropzone-icon-container dropzone-icon-{{ size }}">
          <i class="fas fa-spinner fa-spin dropzone-icon"></i>
        </div>
        <div class="dropzone-text-content">
          <h4 class="dropzone-title">Processing files...</h4>
          <p class="dropzone-subtitle">Please wait while we process your upload</p>
        </div>
        <div class="dropzone-progress-bar">
          <div class="dropzone-progress-fill" style="width: 0%"></div>
        </div>
      </div>
      
      {# Success state #}
      <div class="dropzone-success-state" style="display: none;">
        <div class="dropzone-icon-container dropzone-icon-{{ size }}">
          <i class="fas fa-check-circle dropzone-icon"></i>
        </div>
        <div class="dropzone-text-content">
          <h4 class="dropzone-title">Upload successful!</h4>
          {% if multiple %}
            <p class="dropzone-subtitle">Your files have been uploaded</p>
          {% else %}
            <p class="dropzone-subtitle">Your file has been uploaded</p>
          {% endif %}
        </div>
      </div>
      
      {# Error state #}
      <div class="dropzone-error-state" style="display: none;">
        <div class="dropzone-icon-container dropzone-icon-{{ size }}">
          <i class="fas fa-exclamation-triangle dropzone-icon"></i>
        </div>
        <div class="dropzone-text-content">
          <h4 class="dropzone-title">Upload failed</h4>
          <p class="dropzone-subtitle dropzone-error-message">Please try again</p>
        </div>
      </div>
    </div>
    
    {# File preview area #}
    {% if preview %}
      <div class="dropzone-preview-area" style="display: none;">
        <div class="dropzone-preview-header">
          <h5 class="dropzone-preview-title">Selected Files</h5>
          <button type="button" class="dropzone-preview-clear" onclick="clearDropzoneFiles('{{ dropzoneId }}')">
            <i class="fas fa-times"></i> Clear All
          </button>
        </div>
        <div class="dropzone-preview-list">
          {# File previews will be dynamically inserted here #}
        </div>
      </div>
    {% endif %}
    
    {# HTMX loading indicator #}
    {% if htmxAttributes %}
      <div class="dropzone-htmx-indicator htmx-indicator">
        <div class="dropzone-icon-container dropzone-icon-{{ size }}">
          <i class="fas fa-spinner fa-spin dropzone-icon"></i>
        </div>
        <div class="dropzone-text-content">
          <h4 class="dropzone-title">Uploading...</h4>
          <p class="dropzone-subtitle">Please wait</p>
        </div>
      </div>
    {% endif %}
  </div>
{% endmacro %}

{# Compact DropZone for smaller spaces #}
{% macro CompactDropZone(name='file', accept='', maxSize='5MB', title='Choose file', hint='', required=false, htmxAttributes={}, class='') %}
  {{ DropZone(
    name=name, 
    accept=accept, 
    maxSize=maxSize, 
    size='sm', 
    variant='compact',
    icon='fas fa-paperclip',
    title=title,
    subtitle='',
    hint=hint,
    preview=false,
    required=required,
    htmxAttributes=htmxAttributes,
    class=class
  ) }}
{% endmacro %}

{# Image DropZone with preview #}
{% macro ImageDropZone(name='image', multiple=false, maxSize='5MB', required=false, htmxAttributes={}, class='') %}
  {{ DropZone(
    name=name,
    accept='image/*',
    multiple=multiple,
    maxSize=maxSize,
    icon='fas fa-image',
    title='Drop images here or click to browse',
    subtitle='Supports JPG, PNG, GIF, SVG formats',
    preview=true,
    required=required,
    htmxAttributes=htmxAttributes,
    class=class
  ) }}
{% endmacro %}

{# Document DropZone #}
{% macro DocumentDropZone(name='document', multiple=true, maxSize='10MB', maxFiles=5, required=false, htmxAttributes={}, class='') %}
  {{ DropZone(
    name=name,
    accept='.pdf,.doc,.docx,.txt,.rtf',
    multiple=multiple,
    maxSize=maxSize,
    maxFiles=maxFiles,
    icon='fas fa-file-alt',
    title='Drop documents here or click to browse',
    subtitle='Supports PDF, DOC, DOCX, TXT formats',
    preview=true,
    required=required,
    htmxAttributes=htmxAttributes,
    class=class
  ) }}
{% endmacro %}

{# Archive DropZone #}
{% macro ArchiveDropZone(name='archive', maxSize='50MB', required=false, htmxAttributes={}, class='') %}
  {{ DropZone(
    name=name,
    accept='.zip,.rar,.7z,.tar,.gz',
    maxSize=maxSize,
    icon='fas fa-file-archive',
    title='Drop archive file here or click to browse',
    subtitle='Supports ZIP, RAR, 7Z, TAR, GZ formats',
    preview=false,
    required=required,
    htmxAttributes=htmxAttributes,
    class=class
  ) }}
{% endmacro %}

{# Large DropZone for hero sections #}
{% macro HeroDropZone(name='file', accept='', multiple=true, maxSize='100MB', title='', subtitle='', required=false, htmxAttributes={}, class='') %}
  {% set heroTitle = title or 'Drag and drop your files here' %}
  {% set heroSubtitle = subtitle or 'Or click to browse and select files from your computer' %}
  
  {{ DropZone(
    name=name,
    accept=accept,
    multiple=multiple,
    maxSize=maxSize,
    size='xl',
    variant='default',
    icon='fas fa-cloud-upload-alt',
    title=heroTitle,
    subtitle=heroSubtitle,
    hint='Maximum file size: ' + maxSize,
    preview=true,
    required=required,
    htmxAttributes=htmxAttributes,
    class=class
  ) }}
{% endmacro %} 