{% extends "layouts/admin-layout.njk" %}

{% block content %}
<div class="space-y-6">
    <!-- Header -->
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-2xl font-bold text-white">
                {% if isEdit %}Edit Tool{% else %}Create New Tool{% endif %}
            </h1>
            <p class="text-ocean-100">
                {% if isEdit %}Update the tool information{% else %}Add a new tool to the system{% endif %}
            </p>
        </div>
        <a href="/admin/tools" 
           class="admin-btn-secondary flex items-center">
            <i class="fas fa-arrow-left mr-2"></i>Back to Tools
        </a>
    </div>

    <!-- Error container for HTMX -->
    <div id="error-container"></div>

    <!-- Form -->
    <div class="content-container">
        <form method="POST" 
              action="{{ action }}" 
              class="space-y-6"
              {% if isEdit %}hx-put="{{ action }}"{% else %}hx-post="{{ action }}"{% endif %}
              hx-target="#error-container">
            
            {% if isEdit %}
            <input type="hidden" name="_method" value="PUT">
            {% endif %}

            <!-- Basic Information -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="admin-form-field">
                    <label for="name" class="admin-form-label">
                        Tool Name <span class="text-danger">*</span>
                    </label>
                    <input type="text" 
                           id="name" 
                           name="name" 
                           value="{{ tool.name if tool else '' }}"
                           required
                           class="admin-form-input"
                           placeholder="Enter tool name">
                    <p class="text-xs text-ocean-100/60 mt-1">The display name for the tool</p>
                </div>

                <div class="admin-form-field">
                    <label for="slug" class="admin-form-label">
                        Slug
                    </label>
                    <input type="text" 
                           id="slug" 
                           name="slug" 
                           value="{{ tool.slug if tool else '' }}"
                           class="admin-form-input"
                           placeholder="Auto-generated from name">
                    <p class="text-xs text-ocean-100/60 mt-1">URL-friendly identifier (leave blank to auto-generate)</p>
                </div>
            </div>

            <div class="admin-form-field">
                <label for="description" class="admin-form-label">
                    Description
                </label>
                <textarea id="description" 
                          name="description" 
                          rows="3"
                          class="admin-form-input admin-form-textarea"
                          placeholder="Describe what this tool does">{{ tool.description if tool else '' }}</textarea>
                <p class="text-xs text-ocean-100/60 mt-1">Brief description of the tool's functionality</p>
            </div>

            <!-- Icon and Display -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="admin-form-field">
                    <label for="iconClass" class="admin-form-label">
                        Icon Class
                    </label>
                    <input type="text" 
                           id="iconClass" 
                           name="iconClass" 
                           value="{{ tool.iconClass if tool else '' }}"
                           class="admin-form-input"
                           placeholder="fas fa-tools">
                    <p class="text-xs text-ocean-100/60 mt-1">Font Awesome icon class (e.g., "fas fa-tools")</p>
                </div>

                <div class="admin-form-field">
                    <label for="displayOrder" class="admin-form-label">
                        Display Order
                    </label>
                    <input type="number" 
                           id="displayOrder" 
                           name="displayOrder" 
                           value="{{ tool.displayOrder if tool else '' }}"
                           min="0"
                           class="admin-form-input"
                           placeholder="Auto-assigned">
                    <p class="text-xs text-ocean-100/60 mt-1">Order in which the tool appears (leave blank for auto-assignment)</p>
                </div>
            </div>

            <!-- Status (only for edit) -->
            {% if isEdit %}
            <div class="admin-form-field">
                <label class="flex items-center">
                    <input type="checkbox" 
                           name="isActive" 
                           value="true"
                           {% if tool.isActive %}checked{% endif %}
                           class="rounded border-ocean-400/20 bg-navy-800/50 text-ocean-400 shadow-sm focus:border-ocean-400 focus:ring focus:ring-ocean-400/20">
                    <span class="ml-2 text-sm font-medium text-ocean-100">Tool is active</span>
                </label>
                <p class="text-xs text-ocean-100/60 mt-1">Inactive tools are hidden from users but remain in the system</p>
            </div>
            {% endif %}

            <!-- Tags -->
            <div class="admin-form-field">
                <label class="admin-form-label mb-3">
                    Tags
                </label>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                    {% for tag in tags %}
                    <label class="tool-card p-3 cursor-pointer transition-all hover:scale-105">
                        <input type="checkbox" 
                               name="tagIds" 
                               value="{{ tag.id }}"
                               {% if tool and tool.tags %}
                                   {% for toolTag in tool.tags %}
                                       {% if toolTag.tag.id == tag.id %}checked{% endif %}
                                   {% endfor %}
                               {% endif %}
                               class="rounded border-ocean-400/20 bg-navy-800/50 text-ocean-400 shadow-sm focus:border-ocean-400 focus:ring focus:ring-ocean-400/20">
                        <div class="ml-3 flex items-center">
                            <div class="w-3 h-3 rounded-full mr-2" style="background-color: {{ tag.color }};"></div>
                            <span class="text-sm font-medium text-white">{{ tag.name }}</span>
                        </div>
                    </label>
                    {% endfor %}
                    {% if tags.length == 0 %}
                    <div class="col-span-full text-center py-8 text-ocean-100/60">
                        <i class="fas fa-tags text-2xl mb-2 text-ocean-400/50"></i>
                        <div>No tags available</div>
                        <div class="text-sm">
                            <a href="/admin/tags/new" class="text-sand-300 hover:text-white transition-colors">Create a tag</a> first.
                        </div>
                    </div>
                    {% endif %}
                </div>
                <p class="text-xs text-ocean-100/60 mt-2">Select tags that categorize this tool</p>
            </div>

            <!-- Form Actions -->
            <div class="flex items-center justify-end space-x-4 pt-6 border-t border-ocean-400/10">
                <a href="/admin/tools" 
                   class="admin-btn-secondary">
                    Cancel
                </a>
                <button type="submit" 
                        class="btn-primary flex items-center">
                    <i class="fas fa-save mr-2"></i>
                    {% if isEdit %}Update Tool{% else %}Create Tool{% endif %}
                </button>
            </div>
        </form>
    </div>

    <!-- Preview Section -->
    {% if tool %}
    <div class="content-container">
        <h3 class="text-lg font-medium text-white mb-4">Preview</h3>
        <div class="tool-card p-4">
            <div class="flex items-center">
                <div class="flex-shrink-0 h-12 w-12">
                    <div class="h-12 w-12 rounded-lg flex items-center justify-center" style="background-color: rgba(51, 141, 255, 0.1);">
                        <i class="{{ tool.iconClass or 'fas fa-tools' }} text-ocean-400 text-lg"></i>
                    </div>
                </div>
                <div class="ml-4">
                    <div class="text-lg font-medium text-white">{{ tool.name }}</div>
                    {% if tool.description %}
                    <div class="text-sm text-ocean-100">{{ tool.description }}</div>
                    {% endif %}
                    <div class="flex items-center mt-2 space-x-2">
                        {% if tool.isActive %}
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium" style="background-color: rgba(34, 197, 94, 0.2); color: var(--success);">
                            Active
                        </span>
                        {% else %}
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium" style="background-color: rgba(255, 77, 79, 0.2); color: var(--danger);">
                            Inactive
                        </span>
                        {% endif %}
                        {% for toolTag in tool.tags %}
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium"
                              style="background-color: {{ toolTag.tag.color }}20; color: {{ toolTag.tag.color }};">
                            {{ toolTag.tag.name }}
                        </span>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<script>
// Auto-generate slug from name if slug field is empty
document.getElementById('name').addEventListener('input', function() {
    const slugField = document.getElementById('slug');
    if (!slugField.value || slugField.dataset.autoGenerated === 'true') {
        const slug = this.value
            .toLowerCase()
            .replace(/[^a-z0-9]+/g, '-')
            .replace(/^-+|-+$/g, '');
        slugField.value = slug;
        slugField.dataset.autoGenerated = 'true';
    }
});

// Mark slug as manually edited if user types in it
document.getElementById('slug').addEventListener('input', function() {
    this.dataset.autoGenerated = 'false';
});
</script>
{% endblock %} 