{% extends "layouts/admin-layout.njk" %}

{% block content %}
<div class="p-6">
    <!-- Header Section -->
    <div class="mb-8">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-3xl font-bold text-sand-100 mb-2">
                    {% if isEdit %}Edit User{% else %}Create New User{% endif %}
                </h1>
                <p class="text-neutral-400">
                    {% if isEdit %}Update user information and permissions{% else %}Add a new admin user to the system{% endif %}
                </p>
            </div>
            <div class="flex items-center space-x-3">
                <a href="/admin/users" 
                   class="bg-neutral-600 hover:bg-neutral-700 text-white px-4 py-2 rounded-lg transition-colors duration-200 font-medium flex items-center">
                    <i class="fas fa-arrow-left mr-2"></i>Back to Users
                </a>
            </div>
        </div>
    </div>

    <!-- Form Section -->
    <div class="content-container p-6">
        <form {% if isEdit %}hx-put="{{ action }}"{% else %}hx-post="{{ action }}"{% endif %} 
              hx-target="#error-container" 
              hx-swap="innerHTML"
              class="space-y-6">
            
            <div id="error-container"></div>

            <!-- Basic Information -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="username" class="block text-sm font-medium text-neutral-300 mb-2">
                        Username <span class="text-red-400">*</span>
                    </label>
                    <input type="text" 
                           id="username" 
                           name="username" 
                           value="{{ user.username if user else '' }}"
                           required
                           class="w-full px-3 py-2 bg-dark-700/50 border border-neutral-600/30 rounded-lg text-sand-100 
                                  placeholder-neutral-500 focus:border-ocean-400 focus:ring-2 focus:ring-ocean-400/20 
                                  transition-colors duration-200"
                           placeholder="Enter username">
                </div>

                <div>
                    <label for="email" class="block text-sm font-medium text-neutral-300 mb-2">
                        Email <span class="text-red-400">*</span>
                    </label>
                    <input type="email" 
                           id="email" 
                           name="email" 
                           value="{{ user.email if user else '' }}"
                           required
                           class="w-full px-3 py-2 bg-dark-700/50 border border-neutral-600/30 rounded-lg text-sand-100 
                                  placeholder-neutral-500 focus:border-ocean-400 focus:ring-2 focus:ring-ocean-400/20 
                                  transition-colors duration-200"
                           placeholder="Enter email address">
                </div>
            </div>

            <!-- Password Section -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="password" class="block text-sm font-medium text-neutral-300 mb-2">
                        Password {% if not isEdit %}<span class="text-red-400">*</span>{% endif %}
                    </label>
                    <input type="password" 
                           id="password" 
                           name="password"
                           {% if not isEdit %}required{% endif %}
                           class="w-full px-3 py-2 bg-dark-700/50 border border-neutral-600/30 rounded-lg text-sand-100 
                                  placeholder-neutral-500 focus:border-ocean-400 focus:ring-2 focus:ring-ocean-400/20 
                                  transition-colors duration-200"
                           placeholder="{% if isEdit %}Leave blank to keep current password{% else %}Enter password (min 6 characters){% endif %}">
                    {% if isEdit %}
                    <p class="text-xs text-neutral-500 mt-1">Leave blank to keep current password</p>
                    {% endif %}
                </div>

                <div>
                    <label for="role" class="block text-sm font-medium text-neutral-300 mb-2">
                        Role <span class="text-red-400">*</span>
                    </label>
                    <select id="role" 
                            name="role" 
                            required
                            class="w-full px-3 py-2 bg-dark-700/50 border border-neutral-600/30 rounded-lg text-sand-100 
                                   focus:border-ocean-400 focus:ring-2 focus:ring-ocean-400/20 transition-colors duration-200">
                        {% for role in roles %}
                        <option value="{{ role }}" {% if user and user.role == role %}selected{% elif not user and role == 'ADMIN' %}selected{% endif %}>
                            {% if role == 'SUPER_ADMIN' %}üëë Super Admin{% elif role == 'ADMIN' %}üîß Admin{% else %}üëÅÔ∏è Read Only{% endif %}
                        </option>
                        {% endfor %}
                    </select>
                    <p class="text-xs text-neutral-500 mt-1">
                        Super Admin: Full access including user management<br>
                        Admin: Content management access<br>
                        Read Only: View-only access
                    </p>
                </div>
            </div>

            <!-- Status Section -->
            <div>
                <label class="block text-sm font-medium text-neutral-300 mb-2">Status</label>
                <div class="flex items-center space-x-4">
                    <label class="flex items-center">
                        <input type="radio" 
                               name="isActive" 
                               value="true" 
                               {% if not user or user.isActive %}checked{% endif %}
                               class="mr-2 text-ocean-400 focus:ring-ocean-400/20">
                        <span class="text-green-300">Active</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" 
                               name="isActive" 
                               value="false" 
                               {% if user and not user.isActive %}checked{% endif %}
                               class="mr-2 text-ocean-400 focus:ring-ocean-400/20">
                        <span class="text-red-300">Inactive</span>
                    </label>
                </div>
                <p class="text-xs text-neutral-500 mt-1">Inactive users cannot log in to the admin panel</p>
            </div>

            <!-- Action Buttons -->
            <div class="flex items-center justify-end space-x-4 pt-6 border-t border-neutral-700/50">
                <a href="/admin/users" 
                   class="px-6 py-2 text-neutral-400 hover:text-sand-300 transition-colors duration-200">
                    Cancel
                </a>
                <button type="submit" 
                        class="bg-sunset-500 hover:bg-sunset-600 text-white px-6 py-2 rounded-lg transition-colors duration-200 font-medium flex items-center">
                    <i class="fas fa-{% if isEdit %}save{% else %}plus{% endif %} mr-2"></i>
                    {% if isEdit %}Update User{% else %}Create User{% endif %}
                </button>
            </div>
        </form>
    </div>

    <!-- Additional Information for Edit Mode -->
    {% if isEdit and user %}
    <div class="content-container p-6 mt-6">
        <h3 class="text-lg font-medium text-sand-100 mb-4">User Information</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm">
            <div>
                <span class="text-neutral-400">User ID:</span>
                <span class="text-sand-100 ml-2 font-mono">{{ user.id }}</span>
            </div>
            <div>
                <span class="text-neutral-400">Created:</span>
                <span class="text-sand-100 ml-2">{{ user.createdAt | date('MMM d, yyyy HH:mm') }}</span>
            </div>
            <div>
                <span class="text-neutral-400">Last Updated:</span>
                <span class="text-sand-100 ml-2">{{ user.updatedAt | date('MMM d, yyyy HH:mm') }}</span>
            </div>
            <div>
                <span class="text-neutral-400">Last Login:</span>
                <span class="text-sand-100 ml-2">
                    {% if user.lastLoginAt %}
                        {{ user.lastLoginAt | date('MMM d, yyyy HH:mm') }}
                    {% else %}
                        Never
                    {% endif %}
                </span>
            </div>
        </div>
    </div>

    <!-- Change Password Section -->
    <div class="content-container p-6 mt-6">
        <h3 class="text-lg font-medium text-sand-100 mb-4">Change Password</h3>
        <form hx-post="/admin/users/{{ user.id }}/change-password" 
              hx-target="#password-result" 
              hx-swap="innerHTML"
              class="space-y-4">
            
            <div id="password-result"></div>
            
            <div class="max-w-md">
                <label for="newPassword" class="block text-sm font-medium text-neutral-300 mb-2">
                    New Password <span class="text-red-400">*</span>
                </label>
                <input type="password" 
                       id="newPassword" 
                       name="newPassword"
                       required
                       minlength="6"
                       class="w-full px-3 py-2 bg-dark-700/50 border border-neutral-600/30 rounded-lg text-sand-100 
                              placeholder-neutral-500 focus:border-ocean-400 focus:ring-2 focus:ring-ocean-400/20 
                              transition-colors duration-200"
                       placeholder="Enter new password (min 6 characters)">
            </div>
            
            <button type="submit" 
                    class="bg-ocean-600 hover:bg-ocean-700 text-white px-4 py-2 rounded-lg transition-colors duration-200 font-medium flex items-center">
                <i class="fas fa-key mr-2"></i>Change Password
            </button>
        </form>
    </div>
    {% endif %}
</div>
{% endblock %} 